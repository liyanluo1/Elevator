# 光电传感器NPN输出配置说明

## 传感器规格
- **型号**：对射式红外光电传感器
- **输出类型**：NPN开路集电极
- **工作电压**：DC 5-24V
- **响应频率**：3kHz (<0.33ms)
- **输出信号**：
  - 黑线：常开(NO) - 物体遮挡时导通（低电平）
  - 白线：常闭(NC) - 默认导通，物体遮挡时断开

## 接线方式

### NPN输出接线（推荐）
```
MCU VDD(3.3V) ─┬─ 10kΩ上拉电阻 ─┬─ MCU GPIO输入
                │                 │
                └─ 传感器棕线(+V)  └─ 传感器黑线(NO)
                                    
MCU GND ────────── 传感器蓝线(0V)

传感器白线(NC) ─── 绝缘处理（不使用时）
```

## 代码修改说明

### 1. 头文件修改 (photo_sensor.h)
- 添加了常开(NO)和常闭(NC)两路信号的GPIO定义
- 可通过`USE_NO_SIGNAL`和`USE_NC_SIGNAL`宏选择使用哪路信号
- 调整了去抖时间为10ms（传感器响应<1ms）

### 2. 源文件修改 (photo_sensor.c)
- **GPIO配置**：
  - 常开信号：上拉输入，下降沿触发（物体遮挡时触发）
  - 常闭信号：上拉输入，上升沿触发（物体离开时触发）
  
- **读取逻辑**：
  - `PhotoSensor_ReadNO()`：读取常开信号，遮挡时返回true
  - `PhotoSensor_ReadNC()`：读取常闭信号，遮挡时返回true
  - `PhotoSensor_ReadSensor()`：根据配置自动选择信号

### 3. 中断处理
- 支持双路信号的中断处理
- 在`HAL_GPIO_EXTI_Callback`中根据配置处理对应引脚

## 使用建议

1. **推荐使用常开信号（黑线）**：
   - 更符合直觉：有物体时触发
   - 功耗更低：平时高电平
   - 抗干扰能力强

2. **硬件注意事项**：
   - MCU GPIO必须配置上拉电阻（内部或外部）
   - 传感器与MCU共地连接
   - 未使用的输出线必须绝缘处理

3. **软件配置**：
   - 设置`USE_NO_SIGNAL 1`使用常开信号
   - 根据实际接线修改GPIO引脚定义
   - 可根据需要调整去抖时间

## 故障排查

1. **传感器不触发**：
   - 检查电源电压（5-24V）
   - 确认共地连接
   - 验证上拉电阻配置

2. **误触发**：
   - 增加去抖时间
   - 检查接线是否牢固
   - 确认没有环境光干扰

3. **读数相反**：
   - 确认使用的是NO还是NC信号
   - 检查读取逻辑是否匹配